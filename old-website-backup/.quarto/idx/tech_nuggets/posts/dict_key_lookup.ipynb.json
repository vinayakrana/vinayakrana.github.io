{"title":"Dict Lookup","markdown":{"yaml":{"title":"Dict Lookup","description":"`in dict` vs `in dict.keys()`","date":"2025-06-27","categories":["python","performance","internals"],"format":"html","execute":{"enabled":true}},"headingText":"`x in hmap`","containsRefs":false,"markdown":"\n\nIn Python, checking whether a key exists in a dictionary is a common operation. But there's more than one way to write it:\n\n```python\nif key in my_dict: ...\nif key in my_dict.keys(): ...\n```\n\nAt first glance, both seem correct and equivalent. But they are not equal in performance or clarity.\n\nIn this post, we'll dive into:\n\n* The internal differences between the two\n* The disassembled bytecode\n* Real-world benchmarks using timeit\n* Best practices and when it actually matters\n\nLet's compare the bytecode of two functions, one using `in dict` and the other using `in dict.keys()` to see what Python does under the hood.\n\n\n- Directly uses `COMPARE_OP` with `in` on the dictionary\n- Calls `dict.__contains__`, which is optimized and fast\n\n### `x in hmap.keys()`\n- Calls `.keys()` → creates a `dict_keys` view object\n- Performs a membership test on the view\n\nThis adds extra function calls and memory allocation, even though the lookup is still O(1).\n\n\nLet’s use `timeit` to compare the performance of both lookup styles over 100,000 iterations.\n\n### Summary\n\n| Style               | Performance | Memory | \n|--------------------|-------------|--------|\n| `x in dict`         | Fast        | Low    | \n| `x in dict.keys()`  | Slower      | Higher |\n\n### When to Use `.keys()`\nUse `.keys()` only when you need to iterate over or manipulate the entire view object — not for simple membership tests.\n\n---\n\n### Why It Matters\n\nWhile the difference is small in absolute terms, understanding Python internals helps write clearer and more efficient code. It also prepares you to debug or optimize larger systems more confidently.\n\n","srcMarkdownNoYaml":"\n\nIn Python, checking whether a key exists in a dictionary is a common operation. But there's more than one way to write it:\n\n```python\nif key in my_dict: ...\nif key in my_dict.keys(): ...\n```\n\nAt first glance, both seem correct and equivalent. But they are not equal in performance or clarity.\n\nIn this post, we'll dive into:\n\n* The internal differences between the two\n* The disassembled bytecode\n* Real-world benchmarks using timeit\n* Best practices and when it actually matters\n\nLet's compare the bytecode of two functions, one using `in dict` and the other using `in dict.keys()` to see what Python does under the hood.\n\n\n### `x in hmap`\n- Directly uses `COMPARE_OP` with `in` on the dictionary\n- Calls `dict.__contains__`, which is optimized and fast\n\n### `x in hmap.keys()`\n- Calls `.keys()` → creates a `dict_keys` view object\n- Performs a membership test on the view\n\nThis adds extra function calls and memory allocation, even though the lookup is still O(1).\n\n\nLet’s use `timeit` to compare the performance of both lookup styles over 100,000 iterations.\n\n### Summary\n\n| Style               | Performance | Memory | \n|--------------------|-------------|--------|\n| `x in dict`         | Fast        | Low    | \n| `x in dict.keys()`  | Slower      | Higher |\n\n### When to Use `.keys()`\nUse `.keys()` only when you need to iterate over or manipulate the entire view object — not for simple membership tests.\n\n---\n\n### Why It Matters\n\nWhile the difference is small in absolute terms, understanding Python internals helps write clearer and more efficient code. It also prepares you to debug or optimize larger systems more confidently.\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":true,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"a11y-dark","output-file":"dict_key_lookup.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","theme":"darkly","mainfont":"Roboto","code-copy":true,"title":"Dict Lookup","description":"`in dict` vs `in dict.keys()`","date":"2025-06-27","categories":["python","performance","internals"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}